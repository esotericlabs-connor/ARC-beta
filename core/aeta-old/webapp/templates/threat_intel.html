<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AETA Global Threat Intelligence</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
  </head>
  <body>
    <header class="app-header">
      <h1>Global Threat Intelligence</h1>
      <p class="tagline">Community-driven OSINT telemetry with predictive heat indicators.</p>
      <nav class="app-nav">
        <a href="/">Analyzer</a>
        <a class="active" href="{{ url_for('threat_intel') }}">Global Threat Intel</a>
      </nav>
    </header>

    <main>
      <section class="card">
        <header class="card-header">
          <h2>Overview</h2>
          <p class="hint">Data is anonymised, refreshed from local observations, and never leaves your environment.</p>
        </header>
        <dl class="metrics-grid">
          <div>
            <dt>Total events</dt>
            <dd>{{ snapshot.totals.events }}</dd>
          </div>
          <div>
            <dt>Distinct domains</dt>
            <dd>{{ snapshot.totals.unique_domains }}</dd>
          </div>
          <div>
            <dt>Distinct networks</dt>
            <dd>{{ snapshot.totals.unique_networks }}</dd>
          </div>
          <div>
            <dt>Countries represented</dt>
            <dd>{{ snapshot.totals.unique_countries }}</dd>
          </div>
          <div>
            <dt>Generated</dt>
            <dd>{{ snapshot.generated_at }}</dd>
          </div>
        </dl>
      </section>

      <section class="card">
        <h2>Heat Map by Country</h2>
        <table class="results-table heatmap-table">
          <thead>
            <tr>
              <th>Country</th>
              <th>Incidents</th>
              <th>Intensity</th>
            </tr>
          </thead>
          <tbody>
            {% if snapshot.top_countries %}
              {% for entry in snapshot.top_countries %}
                <tr>
                  <td>{{ entry.value or 'Unknown' }}</td>
                  <td>{{ entry.count }}</td>
                  <td>
                    <div class="heat-bar">
                      <div class="heat-bar-fill" style="width: {{ min(entry.count * 10, 100) }}%"></div>
                    </div>
                  </td>
                </tr>
              {% endfor %}
            {% else %}
              <tr>
                <td colspan="3">No community telemetry recorded yet.</td>
              </tr>
            {% endif %}
          </tbody>
        </table>
      </section>

      <section class="card two-column">
        <div>
          <h2>Top Suspicious Domains</h2>
          <ul class="list-table">
            {% for entry in snapshot.top_domains %}
              <li><span>{{ entry.value }}</span><span class="badge">{{ entry.count }}</span></li>
            {% else %}
              <li>No data yet.</li>
            {% endfor %}
          </ul>
        </div>
        <div>
          <h2>Top Network Prefixes</h2>
          <ul class="list-table">
            {% for entry in snapshot.top_networks %}
              <li><span>{{ entry.value }}</span><span class="badge">{{ entry.count }}</span></li>
            {% else %}
              <li>No data yet.</li>
            {% endfor %}
          </ul>
        </div>
      </section>

      <section class="card">
        <h2>Active Threat Trends</h2>
        <ul class="list-table">
          {% for entry in snapshot.threat_trends %}
            <li><span>{{ entry.value }}</span><span class="badge">{{ entry.count }}</span></li>
          {% else %}
            <li>No high-risk signal clusters detected yet.</li>
          {% endfor %}
        </ul>
      </section>

      <section class="card">
        <h2>Recent Community Events</h2>
        <table class="results-table">
          <thead>
            <tr>
              <th>Timestamp</th>
              <th>Domain</th>
              <th>Network</th>
              <th>Risk</th>
              <th>Tags</th>
            </tr>
          </thead>
          <tbody>
            {% for event in snapshot.recent_events %}
              <tr>
                <td>{{ event.timestamp }}</td>
                <td>{{ event.domain or '—' }}</td>
                <td>{{ event.ip_prefix or '—' }}</td>
                <td>{{ event.risk }}</td>
                <td>
                  {% if event.threat_tags %}
                    {% for tag in event.threat_tags %}
                      <span class="badge">{{ tag }}</span>
                    {% endfor %}
                  {% else %}
                    —
                  {% endif %}
                </td>
              </tr>
            {% else %}
              <tr>
                <td colspan="5">No events recorded yet.</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </section>
    </main>

    <footer class="app-footer">
      <p>Share anonymised telemetry to harden your adaptive defences. Data stays on this host.</p>
    </footer>
  </body>
</html>
